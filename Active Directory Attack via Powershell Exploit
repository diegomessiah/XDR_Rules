title: Detect Active Directory Attack via PowerShell Exploit
id: ad-attack-powershell-001
status: experimental
description: Detects the use of PowerShell commands for exploiting Active Directory, including commands to query, modify, or delete AD objects.
author: Your Name
date: 2025-02-27
logsource:
  category: process_commandline_event
  product: windows
detection:
  selection:
    CommandLine:
      - '*powershell*'
    CommandLine:
      - '*Get-AD*'
      - '*Set-AD*'
      - '*Add-AD*'
      - '*Remove-AD*'
    ActionType:
      - 'ProcessStart'
      - 'ProcessCreate'
  condition: selection
fields:
  - Timestamp
  - DeviceName
  - ProcessName
  - CommandLine
  - ActionType
  - FilePath
falsepositives:
  - Legitimate administrative tasks involving PowerShell and Active Directory
level: high
tags:
  - attack.credential_access
  - attack.t1071.001
  - attack.t1086

---
SELECT Timestamp DeviceName ProcessName CommandLine ActionType FilePath 
FROM ProcessCommandLineEvents
WHERE CommandLine ILIKE "%powershell%" 
AND (CommandLine ILIKE "%Get-AD%" OR CommandLine ILIKE "%Set-AD%" OR CommandLine ILIKE "%Add-AD%" OR CommandLine ILIKE "%Remove-AD%")
AND ActionType IN ("ProcessStart" "ProcessCreate")
ORDER BY Timestamp DESC
---
